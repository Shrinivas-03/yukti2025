{% extends "base.html" %}

{% block title %}Event Registration Counts - YUKTI 2025{% endblock %}

{% block content %}
<div class="container mx-auto py-6">
    <h1 class="text-center text-[#00FFFF] font-['Orbitron'] text-3xl mb-6">Event Registration Counts</h1>
    
    <div class="total-counts bg-blue-100 p-4 rounded-lg shadow-md text-center">
        <span class="block text-lg font-semibold text-gray-700">
            Total Events: <span id="total-events" class="text-blue-600 font-bold">0</span>
        </span>
        <span class="block text-lg font-semibold text-gray-700 mt-2">
            Total Registrations: <span id="total-registrations" class="text-blue-600 font-bold">0</span>
        </span>
    </div>

    <!-- Added refresh button so that updateCounts() can attach its event listener -->
    <button id="refreshButton" class="my-4 bg-blue-500 px-4 py-2 text-white rounded">Refresh Counts</button>

    <!-- Updated grid layout: using Tailwind grid classes -->
    <div id="eventCounts" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Data will be populated here -->
    </div>
</div>

<script>
    const categories = {
        technical: 'Manthana (Technical Events)',
        cultural: 'Manoranjana (Cultural Events)',
        management: 'Chintana (Management Events)',
        visual_art: 'Kalachitrana (Visual Art)',
        games: 'Krida Ratna (Game Zone)'
    };

    const eventNames = {
        prakalpa_prastuthi: 'Prakalpa Prastuthi (Ideathon)',
        chanaksh: 'Chanaksh (Code Quest)',
        robo_samara_war: 'Robo Samara (Robo War)',
        robo_samara_race: 'Robo Samara (Robo Race)',
        pragyan: 'Pragyan (Quiz)',
        vagmita: 'Vagmita (Elocution)',
        ninaad_solo: 'Ninaad (Singing Solo)',
        ninaad_group: 'Ninaad (Singing Group)',
        nritya_solo: 'Nritya Saadhana (Dance Solo)',
        nritya_group: 'Nritya Saadhana (Dance Group)',
        navyataa: 'Navyataa (Ramp Walk)',
        daksha: 'Daksha (Best Manager)',
        shreshta_vitta: 'Shreshta Vitta (Finance)',
        manava_sansadhan: 'Manava Sansadhan (HR)',
        sumedha: 'Sumedha (Start-Up)',
        vipanan: 'Vipanan (Marketing)',
        sthala_chitrapatha: 'Sthala Chitrapatha (Spot Photography)',
        chitragatha: 'Chitragatha (Short Film)',
        ruprekha: 'Ruprekha (Sketch Art)',
        hastakala: 'Hastakala (Painting)',
        swachitra: 'Swachitra (Selfie Point)',
        bgmi: 'BGMI',
        mission_talaash: 'Mission Talaash (Treasure Hunt)'
    };

    function updateCounts() {
        const button = document.getElementById('refreshButton');
        button.classList.add('loading');
        
        fetch('/api/admin/event-counts')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const container = document.getElementById('eventCounts');
                    container.innerHTML = '';

                    // Update total counts
                    let totalRegistrations = 0;
                    Object.values(data.categoryTotals).forEach(count => totalRegistrations += count);
                    document.getElementById('total-registrations').textContent = totalRegistrations;
                    document.getElementById('total-events').textContent = Object.keys(data.counts).length;

                    Object.entries(categories).forEach(([categoryId, categoryName]) => {
                        const categoryEvents = Object.entries(data.counts).filter(([eventId]) => 
                            eventNames[eventId] && getCategoryForEvent(eventId) === categoryId
                        );

                        if (categoryEvents.length > 0) {
                            // Each category section as a grid item with its own grid for events
                            const section = document.createElement('div');
                            section.className = 'category-section border p-4 rounded shadow';
                            
                            section.innerHTML = `
                                <div class="category-header flex justify-between items-center mb-2">
                                    <h2 class="category-name text-xl font-bold">${categoryName}</h2>
                                    <span class="category-total text-sm">Total: ${data.categoryTotals[categoryId] || 0}</span>
                                </div>
                                <div class="grid grid-cols-1 gap-2">
                                    ${categoryEvents.map(([eventId, count]) => `
                                        <div class="flex justify-between items-center bg-gray-800 p-2 rounded">
                                            <span class="event-name">${eventNames[eventId]}</span>
                                            <span class="event-count font-bold">${count}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                            
                            container.appendChild(section);
                        }
                    });
                }
            })
            .catch(error => console.error('Error:', error))
            .finally(() => {
                button.classList.remove('loading');
            });
    }

    function getCategoryForEvent(eventId) {
        const categoryMappings = {
            'prakalpa_prastuthi': 'technical',
            'chanaksh': 'technical',
            'robo_samara_war': 'technical',
            'robo_samara_race': 'technical',
            'pragyan': 'technical',
            'vagmita': 'technical',
            'ninaad_solo': 'cultural',
            'ninaad_group': 'cultural',
            'nritya_solo': 'cultural',
            'nritya_group': 'cultural',
            'navyataa': 'cultural',
            'daksha': 'management',
            'shreshta_vitta': 'management',
            'manava_sansadhan': 'management',
            'sumedha': 'management',
            'vipanan': 'management',
            'sthala_chitrapatha': 'visual_art',
            'chitragatha': 'visual_art',
            'ruprekha': 'visual_art',
            'hastakala': 'visual_art',
            'swachitra': 'visual_art',
            'bgmi': 'games',
            'mission_talaash': 'games'
        };
        return categoryMappings[eventId];
    }

    document.getElementById('refreshButton').addEventListener('click', updateCounts);
    updateCounts();
</script>
{% endblock %}
