{% extends "base.html" %}

{% block title %}Registration - YUKTI 2025{% endblock %}

{% block content %}
<!-- Replace the dividers at top and bottom -->
<div class="h-0.5 bg-gradient-to-r from-[#6D28D9] via-[#3B82F6] to-[#00FFFF]"></div>
<!-- Update the container background -->
<div class="min-h-screen flex flex-col bg-gradient-to-br from-[#1C1C1C] to-[#0A0A0A]">

    <!-- Update the main form container styles -->
    <div class="flex-1 container mx-auto px-4 mt-24 mb-8 max-w-3xl">
        <h1 class="text-4xl font-bold text-[#00FFFF] text-center mb-10 font-['Orbitron']">YUKTI-2025 Registration</h1>

        <!-- Update the form container styles -->
        <div class="bg-[rgba(46,46,46,0.8)] backdrop-blur-md p-6 md:p-8 rounded-xl border-2 border-[#00FFFF] 
                    shadow-[0_0_15px_rgba(0,255,255,0.3)] mb-8 
                    transform transition-all duration-300 hover:border-[#FF00FF] 
                    hover:shadow-[0_15px_30px_rgba(0,255,255,0.4)]">

            <form id="registrationForm" class="space-y-6" onsubmit="event.preventDefault(); submitRegistration();">
                <!-- Event Selection Section -->
                <div class="space-y-6">
                    <div class="registration-section">
                        <h2>Event Registration</h2>
                        <p class="important-note">Note: You can register for only one event.</p>
                    </div>
                    <div class="form-group">
                        <label for="category" class="block text-xl font-bold text-[#00FFFF] mb-2">Select Event Category</label>
                        <select id="category" required 
                                class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                      outline-none transition-all duration-300 hover:border-[#FF00FF]">
                            <option value="" disabled selected>--Select--</option>
                            <option value="technical">Manthana (Technical Events)</option>
                            <option value="management">Chintana (Management Events)</option>
                            <option value="Cultural">Manoranjana (Cultural Events)</option>
                            
                            <option value="VisualArt">Kalachitrana (Visual Art)</option>
                            <option value="games">Krida Ratna (Game Zone)</option>
                        </select>
                    </div>

                    <!-- Events Container -->
                    <div class="form-group">
                        <label class="block text-xl font-bold text-[#00FFFF] mb-2">Select an Event</label>
                        <div id="events-container" 
                             class="grid grid-cols-1 sm:grid-cols-2 gap-4 p-4 bg-[rgba(32,34,39,0.6)] rounded-lg">
                            <p class="text-gray-400">Please select a category first.</p>
                        </div>
                    </div>

                    <!-- Group Size Container -->
                    <div id="group-size-container" class="hidden space-y-2">
                        <label for="group-size" class="block text-xl md:text-xl lg:text-2xl font-bold text-[#00FFFF] mb-2 text-base sm:text-lg">
                            Number of Participants
                        </label>
                        <div class="flex items-center space-x-4">
                            <button type="button" id="decrease-size" 
                                    class="w-12 h-12 rounded-full bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] text-[#00FFFF] 
                                           text-2xl font-bold flex items-center justify-center
                                           transition-all duration-300 hover:bg-[#00FFFF] hover:text-black
                                           disabled:opacity-50 disabled:cursor-not-allowed">
                                -
                            </button>
                            <input type="number" id="group-size" value="1" readonly
                                   class="w-16 sm:w-20 p-2 sm:p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                          outline-none text-center text-base sm:text-xl font-bold">
                            <button type="button" id="increase-size"
                                    class="w-12 h-12 rounded-full bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] text-[#00FFFF]
                                           text-2xl font-bold flex items-center justify-center
                                           transition-all duration-300 hover:bg-[#00FFFF] hover:text-black
                                           disabled:opacity-50 disabled:cursor-not-allowed">
                                +
                            </button>
                        </div>
                        <div id="group-size-error" class="text-red-500 text-sm hidden"></div>
                    </div>

                    <div id="team-members-container" class="hidden space-y-4">
                        <label class="block text-base sm:text-lg md:text-xl font-bold text-[#00FFFF] mb-2">Team Members</label>
                        <div id="member-inputs" class="space-y-3">
                            <!-- Member inputs will be generated dynamically -->
                        </div>
                        <div id="team-error" class="text-red-500 text-sm hidden">Please enter all team member names</div>
                    </div>

                    <!-- Update the individual participant container -->
                    <div id="individual-participant-container" class="hidden space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="individual-participant" class="block text-[#00FFFF] mb-2">Participant Name <span class="text-red-500">*</span></label>
                                <input type="text" 
                                       id="individual-participant" 
                                       placeholder="Enter Your Name" 
                                       class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                              placeholder:text-gray-400 outline-none transition-all duration-300
                                              focus:border-[#FF00FF] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]">
                            </div>
                            <div>
                                <label for="individual-usn" class="block text-[#00FFFF] mb-2">USN Number / Roll.No. <span class="text-red-500">*</span></label>
                                <input type="text" 
                                       id="individual-usn" 
                                       placeholder="Enter USN / Roll.No. (e.g., 1KS22MB023)" 
                                       pattern="[1-4][A-Z]{2}[0-9]{2}[A-Z]{2}[0-9]{3}"
                                       class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                              placeholder:text-gray-400 outline-none transition-all duration-300
                                              focus:border-[#FF00FF] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]">
                            </div>
                        </div>
                        <div id="individual-error" class="text-red-500 text-sm hidden">Please enter both name and USN / Roll.No.</div>
                    </div>

                    <!-- Add Button -->
                    <button type="button" id="add-event-btn" disabled
                            class="w-full bg-[#FF00FF] text-white py-3 px-6 rounded-lg font-bold uppercase 
                                   transition-all duration-300 hover:bg-transparent hover:text-[#FF00FF] 
                                   hover:border-2 hover:border-[#FF00FF] disabled:opacity-50 
                                   disabled:cursor-not-allowed">
                        NEXT
                    </button>
                </div>
            </form>
        </div>

        <!-- Add this after the add-event-btn  -->
        <div class="selected-events-section hidden mt-8 bg-[rgba(40,40,40,0.95)] p-6 rounded-xl border-2 border-[#00FFFF]">
            <h3 class="text-2xl font-bold text-[#00FFFF] mb-6">Selected Events</h3>
            <div id="selected-events-list" class="space-y-4">
                <!-- Selected events will be dynamically added here -->
            </div>
            
            <!-- Personal Details Section -->
            <div class="personal-details-section mt-8 space-y-6">
                <h3 class="text-2xl font-bold text-[#00FFFF] mb-6">Personal Details</h3>
                <div class="space-y-4">
                    <div class="form-group">
                        <label for="college" class="block text-[#00FFFF] mb-2">College Name <span class="text-red-500">*</span></label>
                        <div class="relative">
                            <select id="collegeSelect" 
                                    class="w-full p-3 bg-[rgba(30,30,30,0.9)] border-2 border-[#00FFFF] rounded-lg 
                                           text-gray-300 focus:outline-none focus:border-[#FF00FF] transition-colors"
                                    onchange="handleCollegeSelection()">
                                <option value="">Select your college</option>
                                <option value="VTU CPGS, Kalaburagi">VTU CPGS, Kalaburagi</option>
                                <option value="GNDEC Bidar">GNDEC Bidar</option>
                                <option value="PDA College of Engineering">PDA College of Engineering</option>
                                <option value="Godutai Engineering College for Women">Godutai Engineering College for Women</option>
                                <option value="Appa Institute of Engineering & Technology">Appa Institute of Engineering & Technology</option>
                                <option value="Sharnbasva University">Sharnbasva University</option>
                                <option value="Khaja Banda Nawaz University">Khaja Banda Nawaz University</option>
                                <option value="Central University of Karnataka">Central University of Karnataka</option>
                                <option value="other">Other</option>
                            </select>
                            
                            <!-- Other college input field (hidden by default) -->
                            <input type="text" 
                                   id="otherCollege" 
                                   name="college" 
                                   placeholder="Enter your college name"
                                   class="w-full p-3 bg-[rgba(30,30,30,0.9)] border-2 border-[#00FFFF] rounded-lg 
                                          text-gray-300 focus:outline-none focus:border-[#FF00FF] transition-colors mt-2 hidden">
                        </div>
                    </div>
                    
                    <div>
                        <label for="email" class="block text-white mb-2">Email <span class="text-red-500">*</span></label>
                        <input type="email" 
                               id="email" 
                               placeholder="Enter your email" 
                               required
                               oninput="validateEmail()"
                               class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                      placeholder:text-gray-400 outline-none transition-all duration-300
                                      focus:border-[#FF00FF] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]">
                        <div id="email-error" class="text-red-500 text-sm mt-1 hidden">Please enter a valid mail id</div>
                    </div>
                    
                    <!-- Update the phone input field -->
                    <div>
                        <label for="phone" class="block text-white mb-2">Phone (WhatsApp) <span class="text-red-500">*</span></label>
                        <input type="tel" 
                               id="phone" 
                               placeholder="Enter your WhatsApp number" 
                               maxlength="10"
                               oninput="validatePhone()"
                               class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white
                                      placeholder:text-gray-400 outline-none transition-all duration-300
                                      focus:border-[#FF00FF] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]">
                        <div id="phone-error" class="text-red-500 text-sm mt-1 hidden"></div>
                    </div>
                </div>

                <div class="mt-4">
                    <p class="text-gray-400 mb-2">*Accommodation is not available.</p>
                    <p class="text-xl font-bold text-[#00FFFF]">Total Cost: ₹<span class="total-cost">0</span></p>
                    <p class="text-sm sm:text-base italic text-[#FF00FF] mb-4 
          border-l-4 border-[#FF00FF] pl-3 
          bg-[rgba(255,0,255,0.1)] py-2 rounded-r-md
          animate-pulse">
    *Check all the details before Registering.
</p>

                </div>

                <button type="button" 
                        onclick="submitRegistration()"
                        class="w-full bg-[#FF00FF] text-white py-3 px-6 rounded-lg font-bold uppercase 
                               transition-all duration-300 hover:bg-transparent hover:text-[#FF00FF] 
                               hover:border-2 hover:border-[#FF00FF] relative"
                        id="submitButton">
                    <span class="inline-flex items-center">
                        <span class="button-text">Register Now</span>
                        <svg class="animate-spin ml-2 h-5 w-5 hidden" id="spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                        </svg>
                    </span>
                </button>
            </div>
        </div>
    </div>
</div>
<!-- Replace bottom divider -->
<div class="h-0.5 bg-gradient-to-r from-[#6D28D9] via-[#3B82F6] to-[#00FFFF]"></div>

<!-- Replace the existing <style> section with these classes -->
<style>
.selected-event {
    background: rgba(46,46,46,0.9);
    padding: 1rem;
    border-radius: 0.5rem;
    border: 2px solid #00FFFF;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.selected-event span {
    color: #C0C0C0;
    word-break: break-word;
    max-width: 80%;
}

.remove-event-btn {
    color: rgb(239, 68, 68);
    font-weight: bold;
    font-size: 1.25rem;
    padding: 0.5rem;
    transition: color 0.3s;
}

.remove-event-btn:hover {
    color: rgb(248, 113, 113);
}

.event-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    border-radius: 0.5rem;
    cursor: pointer;
}

.event-option input[type="radio"] {
    width: 1rem;
    height: 1rem;
    cursor: pointer;
    accent-color: #03e9f4;
}

.event-option label {
    color: #C0C0C0;
    cursor: pointer;
    user-select: none;
}

.error-border {
    border-color: rgb(239, 68, 68);
}

/* Additional Styles */
.event-option {
    border: 2px solid #03e9f4;
    transition: all 0.3s ease;
    background: rgba(3, 233, 244, 0.05);
}

.event-option:hover {
    transform: translateX(10px);
    box-shadow: 0 0 15px rgba(3, 233, 244, 0.5);
    background: rgba(3, 233, 244, 0.1);
}

.event-option input[type="radio"]:checked + label {
    color: #03e9f4;
    text-shadow: 0 0 5px #03e9f4;
}

.member-input {
    margin-bottom: 0.75rem;
}

.member-input input {
    width: 100%;
    padding: 0.75rem;
    background: rgba(32,34,39,0.8);
    border: 2px solid #00FFFF;
    border-radius: 0.5rem;
    color: white;
    outline: none;
    transition: all 0.3s ease;
}

.member-input input:focus {
    border-color: #FF00FF;
    box-shadow: 0 0 8px rgba(3,233,244,0.4);
}

.member-input input::placeholder {
    color: #9CA3AF;
}

/* Responsive styles for all devices */
@media (max-width: 640px) {
    .flex-1.container {
        padding: 0.5rem;
        margin-top: 5rem;
    }

    h1.text-4xl {
        font-size: 1.75rem;
        margin-bottom: 1.5rem;
    }

    .form-group label {
        font-size: 1rem;
    }

    #events-container {
        padding: 0.75rem;
    }

    .selected-event {
        padding: 0.75rem;
        font-size: 0.875rem;
    }

    .selected-event span {
        font-size: 0.875rem;
    }

    .member-input input {
        padding: 0.5rem;
        font-size: 0.875rem;
    }

    .personal-details-section h3 {
        font-size: 1.25rem;
        margin-bottom: 1rem;
    }

    .personal-details-section label {
        font-size: 0.875rem;
    }

    .personal-details-section input {
        padding: 0.5rem;
        font-size: 0.875rem;
    }

    .total-cost {
        font-size: 1.25rem;
    }

    button {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
    }

    #paymentSection {
        padding: 1rem;
    }

    #paymentSection h2 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }

    .bank-details h3 {
        font-size: 1.25rem;
    }

    .account-details {
        font-size: 0.875rem;
    }
    
    #group-size-container label,
    #team-members-container label {
        font-size: 1rem;
    }
    
    #group-size {
        font-size: 1rem;
        padding: 0.5rem;
    }
    
    .member-input label {
        font-size: 0.875rem;
    }
    
    .member-input input {
        font-size: 0.875rem;
        padding: 0.5rem;
    }
}

/* Tablet adjustments */
@media (min-width: 641px) and (max-width: 1024px) {
    .flex-1.container {
        padding: 1rem;
    }

    h1.text-4xl {
        font-size: 2rem;
    }

    .form-group label {
        font-size: 1.125rem;
    }
}

/* Ensure touch targets are large enough on mobile */
@media (hover: none) and (pointer: coarse) {
    input, 
    select, 
    button {
        min-height: 44px;
    }

    .event-option {
        padding: 0.75rem;
    }

    .remove-event-btn {
        padding: 0.5rem 0.75rem;
        font-size: 1.25rem;
    }
}

/* Professional spacing adjustments */
.space-y-6 > * {
    margin-top: 1rem;
    margin-bottom: 1rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.shadow-xl {
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

/* Improved input styling */
input, select {
    font-size: 0.9375rem;
    letter-spacing: 0.01em;
}

/* Better text readability */
label, p {
    letter-spacing: 0.01em;
    line-height: 1.5;
}

/* Add container width adjustments for different screen sizes */
@media (max-width: 640px) {
    .container {
        max-width: 95%;
        padding: 0 1rem;
    }
}

@media (min-width: 641px) and (max-width: 1024px) {
    .container {
        max-width: 85%;
        padding: 0 2rem;
    }
}

@media (min-width: 1025px) {
    .container {
        max-width: 800px; /* Fixed maximum width for larger screens */
    }
}

/* Update input fields */
input, select {
    background: rgba(32,34,39,0.8);
    border: 2px solid #00FFFF;
    color: white;
    outline: none;
    transition: all 0.3s ease;
}

input::placeholder {
    color: #9CA3AF;
}

input:focus, select:focus {
    border-color: #FF00FF;
    box-shadow: 0 0 15px rgba(255,0,255,0.3);
}

/* Update labels */
label {
    color: #00FFFF;
    font-family: 'Orbitron', sans-serif;
}

/* Update buttons */
button {
    background: #FF00FF;
    color: white;
    transition: all 0.3s ease;
}

button:hover {
    background: transparent;
    color: #FF00FF;
    border: 2px solid #FF00FF;
}

/* Update event cards */
.event-option {
    background: rgba(32,34,39,0.8);
    border: 2px solid #00FFFF;
    transition: all 0.3s ease;
}

.event-option:hover {
    border-color: #FF00FF;
    box-shadow: 0 0 15px rgba(255,0,255,0.3);
}

/* Update selected events */
.selected-event {
    background: rgba(46,46,46,0.8);
    backdrop-filter: blur(12px);
    border: 2px solid #00FFFF;
    transition: all 0.3s ease;
}

.selected-event:hover {
    border-color: #FF00FF;
    box-shadow: 0 0 15px rgba(255,0,255,0.3);
}

/* Cost display */
.total-cost {
    color: #00FFFF;
    font-family: 'Orbitron', sans-serif;
}

/* Error messages */
.error-border {
    border-color: #FF00FF;
}

/* Radio buttons */
input[type="radio"]:checked + label {
    color: #00FFFF;
    text-shadow: 0 0 10px rgba(0,255,255,0.5);
}

/* Add this style section with the spinner animation */
.spinner {
    display: none;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
    margin-left: 8px;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

.button-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

/* ...rest of existing styles... */

#group-size {
    -moz-appearance: textfield;
    cursor: default;
}

#group-size::-webkit-outer-spin-button,
#group-size::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

#decrease-size:not(:disabled):hover,
#increase-size:not(:disabled):hover {
    transform: scale(1.1);
}

#decrease-size:disabled,
#increase-size:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.important-note {
    color: #ff4444;
    font-weight: bold;
    margin-bottom: 1em;
}
</style>

<!-- Keep existing JavaScript -->
<script>
        const addEventBtn = document.getElementById("add-event-btn");
        const selectedEventsList = document.getElementById("selected-events-list");
        const selectedEventsSection = document.querySelector(".selected-events-section");
        const personalDetailsSection = document.querySelector(".personal-details-section");
        const groupSizeError = document.getElementById("group-size-error");
        const individualParticipantContainer = document.getElementById("individual-participant-container");
        const individualParticipantInput = document.getElementById("individual-participant");
        const overallParticipantsSpan = document.getElementById("overallParticipants");
        const categorySelect = document.getElementById("category");  // Add this line
        const eventsContainer = document.getElementById("events-container");  // Add this line
        const memberInputsContainer = document.getElementById("member-inputs");  // Add this line
        const groupSizeInput = document.getElementById("group-size");  // Add this line
        const groupSizeContainer = document.getElementById("group-size-container");
        const teamMembersContainer = document.getElementById("team-members-container");
        // Initialize selectedEvents array
        let selectedEvents = [];
        let currentEventSelection = null;

        
        const events = {
            technical: [
                { name: "Prakalpa Prastuthi (Ideathon)", type: "team", cost: 300, minTeam: 2, maxTeam: 4 },
                { name: "Chanaksh (Code Quest)", type: "individual", cost: 200 },
                { name: "Robo Samara (Robo War)", type: "team", cost: 300, minTeam: 1, maxTeam: 4},
                { name: "Robo Samara (Robo Race)", type: "team", cost: 300, minTeam: 1, maxTeam: 4},
                { name: "Pragyan (Quiz)", type: "team", cost: 300, minTeam: 3, maxTeam: 3},
                { name: "Vagmita (Elocution)", type: "individual", cost: 150 }
            ],
            VisualArt: [
                
                { name: "Sthala Chitrapatha (Spot Photography)", type: "individual", cost: 200 },
                { name: "Chitragatha (Short Film)", type: "team", cost: 300, minTeam: 1, maxTeam: 5 },
                { name: "Ruprekha (Sketch Art)", type: "individual", cost: 200 },
                { name: "Hastakala (Painting)", type: "individual", cost: 200 },
                { name: "Swachitra (Selfie Point)", type: "individual", cost: 100 },
            ],
            Cultural: [
                { name: "Ninaad (Singing Solo)", type: "individual", cost: 200 },
                { name: "Ninaad (Singing Group)", type: "team", cost: 500,minTeam:4, maxTeam:10 },
                { name: "Nritya Saadhana (Dance Solo)", type: "individual", cost: 299 },
                { name: "Nritya Saadhana (Dance Group)", type: "team", cost: 499 ,minTeam:4, maxTeam:10},
               
                { name: "Navyataa (Ramp Walk)", type: "individual", cost: 200 },
            ],
            management: [
               
                { name: "Daksha (Best Manager)", type: "individual", cost: 200 },
                { name: "Shreshta Vitta (Finance) ", type: "team", cost: 250 ,minTeam:1 , maxTeam:3 },
                { name: "Manava Sansadhan (HR)", type: "individual", cost: 200 },
                { name: "Sumedha (Start-Up)", type: "team", cost: 399 , minTeam: 2 , maxTeam:3 },
                { name: "Vipanan (Marketing)", type: "team", cost: 200,minTeam:2 ,maxTeam:2 }
            ],
            games: [
                { name: "BGMI", type: "team", cost: 500, minTeam: 1, maxTeam: 5 },
                { name: "Mission Talaash (Treasure Hunt)", type: "team", cost: 1000, minTeam: 5, maxTeam: 5 }
            ]
        };

        function updateTotalCost() {
            let totalCost = 0;
            selectedEvents.forEach(event => {
                totalCost += event.cost; // Use the actual event cost instead of COST_PER_EVENT
            });
            document.querySelector('.total-cost').textContent = totalCost;
        }

        // Remove or comment out the COST_PER_EVENT constant since we're not using it anymore
        // const COST_PER_EVENT = 200;

        groupSizeInput.addEventListener("change", function() {
            const numberOfMembers = parseInt(this.value);
            generateMemberInputs(numberOfMembers);
        });

        // Modified team member input generator to clamp count between minTeam and maxTeam
        function generateMemberInputs(count) {
            memberInputsContainer.innerHTML = '';
            teamMembersContainer.classList.remove("hidden");

            if (currentEventSelection && currentEventSelection.type === "team") {
                // Clamp count between event.minTeam and event.maxTeam
                count = Math.min(Math.max(parseInt(count), currentEventSelection.minTeam), currentEventSelection.maxTeam);
                groupSizeInput.value = count;

                for (let i = 1; i <= count; i++) {
                    const memberDiv = document.createElement("div");
                    memberDiv.className = "member-input grid grid-cols-2 gap-4 mb-4";
                    
                    // Name Input Wrapper
                    const nameWrapper = document.createElement("div");
                    const nameLabel = document.createElement("label");
                    nameLabel.className = "block text-sm sm:text-base text-[#00FFFF] mb-2";
                    nameLabel.innerHTML = `Member ${i} Name <span class="text-red-500">*</span>`;
                    
                    const nameInput = document.createElement("input");
                    nameInput.type = "text";
                    nameInput.id = `member-${i}`;
                    nameInput.name = `member-${i}`;
                    nameInput.placeholder = `Member ${i} Name`;
                    nameInput.className = "w-full p-2 sm:p-3 text-sm sm:text-base bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white \
                                         placeholder:text-gray-400 outline-none transition-all duration-300 \
                                         focus:border-[#FF00FF] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]";
                    // Add name validation for team member name
                    nameInput.addEventListener('input', function() {
                        validateMemberName(this);
                    });
                    nameInput.addEventListener('keyup', function() {
                        validateMemberName(this);
                    });
                    
                    nameWrapper.appendChild(nameLabel);
                    nameWrapper.appendChild(nameInput);
                    
                    // USN Input Wrapper
                    const usnWrapper = document.createElement("div");
                    const usnLabel = document.createElement("label");
                    usnLabel.className = "block text-sm sm:text-base text-[#00FFFF] mb-2";
                    usnLabel.innerHTML = `Member ${i} USN / Roll.No. <span class="text-red-500">*</span>`;
                    
                    const usnInput = document.createElement("input");
                    usnInput.type = "text";
                    usnInput.id = `usn-${i}`;
                    usnInput.name = `usn-${i}`;
                    usnInput.placeholder = "Enter USN / Roll.No. (e.g., 1KS22MB023)";
                    usnInput.pattern = "[1-4][A-Z]{2}[0-9]{2}[A-Z]{2}[0-9]{3}";
                    usnInput.className = "w-full p-2 sm:p-3 text-sm sm:text-base bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white \
                                        placeholder:text-gray-400 outline-none transition-all duration-300 \
                                        focus:border-[#FF00FF] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]";
                    
                    usnWrapper.appendChild(usnLabel);
                    usnWrapper.appendChild(usnInput);
                    
                    memberDiv.appendChild(nameWrapper);
                    memberDiv.appendChild(usnWrapper);
                    memberInputsContainer.appendChild(memberDiv);
                }
            }
            updateTotalParticipants();
        }

        addEventBtn.addEventListener("click", function() {
            if (currentEventSelection) {
                let hasError = false;

                // Validate inputs and create event details
                const eventDetails = {
                    category: categorySelect.value,
                    event: currentEventSelection.name,
                    type: currentEventSelection.type,
                    cost: currentEventSelection.cost
                };

                if (currentEventSelection.type === "team") {
                    eventDetails.members = [];
                    const memberDivs = memberInputsContainer.querySelectorAll(".member-input");
                    
                    memberDivs.forEach(div => {
                        const nameInput = div.querySelector('input[id^="member-"]');
                        const usnInput = div.querySelector('input[id^="usn-"]');
                        
                        if (!nameInput || !usnInput || !nameInput.value.trim() || !usnInput.value.trim()) {
                            hasError = true;
                            if (nameInput) nameInput.classList.add('error-border');
                            if (usnInput) usnInput.classList.add('error-border');
                        } else {
                            if (nameInput) nameInput.classList.remove('error-border');
                            if (usnInput) usnInput.classList.remove('error-border');
                            eventDetails.members.push({
                                name: nameInput.value.trim(),
                                usn: usnInput.value.trim()
                            });
                        }
                    });

                    if (hasError) {
                        document.getElementById('team-error').style.display = 'block';
                        return;
                    }
                    document.getElementById('team-error').style.display = 'none';
                } else {
                    // Handle individual participant
                    const nameInput = document.getElementById('individual-participant');
                    const usnInput = document.getElementById('individual-usn');
                    
                    if (!nameInput || !usnInput || !nameInput.value.trim() || !usnInput.value.trim()) {
                        hasError = true;
                        if (nameInput) nameInput.classList.add('error-border');
                        if (usnInput) nameInput.classList.add('error-border');
                        document.getElementById('individual-error').style.display = 'block';
                        return;
                    }
                    
                    nameInput.classList.remove('error-border');
                    usnInput.classList.remove('error-border');
                    document.getElementById('individual-error').style.display = 'none';
                    
                    eventDetails.participant = {
                        name: nameInput.value.trim(),
                        usn: usnInput.value.trim()
                    };
                }

                if (!hasError) {
                    selectedEvents.push(eventDetails);
                    updateSelectedEventsList();
                    updateTotalCost();
                    resetEventSelection();
                    selectedEventsSection.classList.remove("hidden");
                    personalDetailsSection.classList.remove("hidden");
                }
            }
        });

        function updateSelectedEventsList() {
            const selectedEventsList = document.getElementById('selected-events-list');
            const selectedEventsSection = document.querySelector('.selected-events-section');
            selectedEventsList.innerHTML = '';
            
            selectedEvents.forEach((event, index) => {
                const eventDiv = document.createElement('div');
                eventDiv.className = 'selected-event';
                
                let membersText = '';
                if (event.members && event.members.length > 0) {
                    membersText = `<br>Members: ${event.members.map(member => `${member.name} (USN: ${member.usn})`).join(", ")}`;
                } else if (event.participant) {
                    membersText = `<br>Participant: ${event.participant.name} (USN: ${event.participant.usn})`;
                }

                eventDiv.innerHTML = `
                    <span>${event.event} - ${event.type.charAt(0).toUpperCase() + event.type.slice(1)}
                    <br>Category: ${event.category}${membersText}
                    <br>Cost: ₹${event.cost}</span>
                    <button type="button" onclick="removeEvent(${index})" class="remove-event-btn">×</button>
                `;
                
                selectedEventsList.appendChild(eventDiv);
            });

            // Show/hide sections based on selected events
            if (selectedEvents.length > 0) {
                selectedEventsSection.classList.remove('hidden');
                document.querySelector('.personal-details-section').classList.remove('hidden');
                
                // Disable category select and event options
                categorySelect.disabled = true;
                const radioInputs = document.querySelectorAll('input[name="event"]');
                radioInputs.forEach(input => input.disabled = true);
                
                // Disable add event button
                addEventBtn.disabled = true;
                addEventBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                selectedEventsSection.classList.add('hidden');
                document.querySelector('.personal-details-section').classList.add('hidden');
                
                // Re-enable category select and event options
                categorySelect.disabled = false;
                const radioInputs = document.querySelectorAll('input[name="event"]');
                radioInputs.forEach(input => input.disabled = false);
            }
            
            updateTotalCost();
        }

        function resetEventSelection() {
            const radioInputs = document.querySelectorAll('input[name="event"]');
            radioInputs.forEach(input => input.checked = false);
            groupSizeContainer.classList.add("hidden");
            teamMembersContainer.classList.add("hidden");
            individualParticipantContainer.classList.add("hidden");
            currentEventSelection = null;
            addEventBtn.disabled = true;
        }

        window.removeEvent = function(index) {
            selectedEvents.splice(index, 1);
            updateSelectedEventsList();
            updateTotalCost(); // Add this line
            if (selectedEvents.length === 0) {
                selectedEventsSection.classList.add("hidden");
                personalDetailsSection.classList.add("hidden");
                addEventBtn.disabled = false;
                addEventBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                
                // Clear and reset form
                resetEventSelection();
                categorySelect.disabled = false;
                const radioInputs = document.querySelectorAll('input[name="event"]');
                radioInputs.forEach(input => input.disabled = false);
            }
        };

        categorySelect.addEventListener("change", function () {
            const selectedCategory = categorySelect.value;
            eventsContainer.innerHTML = '';

            if (selectedCategory && events[selectedCategory]) {
                events[selectedCategory].forEach(event => {
                    let div = document.createElement("div");
                    div.classList.add("event-option");

                    let input = document.createElement("input");
                    input.type = "radio";
                    input.name = "event";
                    input.value = event.name;
                    input.id = event.name.replace(/\s+/g, "-").toLowerCase();

                    let label = document.createElement("label");
                    label.htmlFor = input.id;
                    // Only show event name without team size or cost
                    label.textContent = event.name;

                    div.appendChild(input);
                    div.appendChild(label);
                    eventsContainer.appendChild(div);

                    input.addEventListener("change", function () {
                        currentEventSelection = event;
                        addEventBtn.disabled = false;
                        
                        if (event.type === "team") {
                            groupSizeContainer.classList.remove("hidden");
                            teamMembersContainer.classList.remove("hidden");
                            individualParticipantContainer.classList.add("hidden");
                            
                            // Set min and max based on event configuration
                            groupSizeInput.min = event.minTeam;
                            groupSizeInput.max = event.maxTeam;
                            groupSizeInput.value = event.minTeam;
                            
                            // Update label to show allowed team size
                            const sizeLabel = groupSizeContainer.querySelector('label');
                            sizeLabel.innerHTML = `<strong>Number of Participants (${event.minTeam}-${event.maxTeam})</strong>`;
                        } else {
                            groupSizeContainer.classList.add("hidden");
                            teamMembersContainer.classList.add("hidden");
                            individualParticipantContainer.classList.remove("hidden");
                            individualParticipantInput.required = true;
                            individualParticipantInput.value = ""; // clear previous value
                            groupSizeInput.value = 1;
                        }
                        
                        generateMemberInputs(parseInt(groupSizeInput.value));
                    });
                });
            } else {
                eventsContainer.innerHTML = '<p>Please select a category first.</p>';
            }
        });

        // Validate team size when changed
        groupSizeInput.addEventListener("change", function() {
            const value = parseInt(this.value);
            const min = parseInt(this.min);
            const max = parseInt(this.max);

            if (value < min) {
                this.value = min;
            } else if (value > max) {
                this.value = max;
            }

            generateMemberInputs(parseInt(this.value));
        });

        // Modified event radio button change handler
        eventsContainer.addEventListener("change", function(e) {
            if (e.target.type === "radio") {
                const selectedEvent = events[categorySelect.value].find(event => event.name === e.target.value);
                if (selectedEvent) {
                    currentEventSelection = selectedEvent;
                    addEventBtn.disabled = false;

                    // Show group size container for both team and individual
                    groupSizeContainer.classList.remove("hidden");
                    
                    if (selectedEvent.type === "team") {
                        teamMembersContainer.classList.remove("hidden");
                        individualParticipantContainer.classList.add("hidden");
                        
                        // Initialize size input for team
                        groupSizeInput.value = selectedEvent.minTeam;
                        groupSizeInput.min = selectedEvent.minTeam;
                        groupSizeInput.max = selectedEvent.maxTeam;
                        
                        const decreaseBtn = document.getElementById("decrease-size");
                        const increaseBtn = document.getElementById("increase-size");
                        
                        // Enable/disable buttons for team events
                        decreaseBtn.disabled = true;
                        increaseBtn.disabled = false;
                        
                        // Update label for team size
                        const sizeLabel = groupSizeContainer.querySelector('label');
                        sizeLabel.innerHTML = `<strong>Number of Participants (${selectedEvent.minTeam}-${selectedEvent.maxTeam})</strong>`;
                        
                    } else {
                        // For individual events
                        teamMembersContainer.classList.add("hidden");
                        individualParticipantContainer.classList.remove("hidden");
                        
                        // Set fixed value of 1 for individual
                        groupSizeInput.value = 1;
                        groupSizeInput.min = 1;
                        groupSizeInput.max = 1;
                        
                        // Disable both buttons for individual
                        document.getElementById("decrease-size").disabled = true;
                        document.getElementById("increase-size").disabled = true;
                        
                        // Update label for individual
                        const sizeLabel = groupSizeContainer.querySelector('label');
                        sizeLabel.innerHTML = `<strong>Number of Participants (1)</strong>`;
                    }
                    
                    generateMemberInputs(parseInt(groupSizeInput.value));
                }
            }
        });

        // Group size input validation
        groupSizeInput.addEventListener("input", function() {
            if (!currentEventSelection) return;
            
            let value = parseInt(this.value) || 0;
            const min = currentEventSelection.minTeam || 1;
            const max = currentEventSelection.maxTeam || 1;
            
            if (value < min) {
                this.value = min;
            } else if (value > max) {
                this.value = max;
            }
            
            this.value = value;
            generateMemberInputs(parseInt(this.value));
        });

        // Restrict groupSizeInput value on user input
        groupSizeInput.addEventListener("input", function() {
            if (!currentEventSelection || currentEventSelection.type !== "team") return;
            
            let value = parseInt(this.value) || currentEventSelection.minTeam;
            const min = currentEventSelection.minTeam;
            const max = currentEventSelection.maxTeam;
            
            if (value < min || value > max) {
                groupSizeError.textContent = `Please enter a value between ${min} and ${max}.`;
                groupSizeError.classList.remove("hidden");
                addEventBtn.disabled = true;
            } else {
                groupSizeError.textContent = "";
                groupSizeError.classList.add("hidden");
                addEventBtn.disabled = false;
                this.value = value;
                generateMemberInputs(value);
            }
        });

        // Add new styles for event options
        const additionalStyles = `
            .event-option {
                border: 2px solid #03e9f4;
                transition: all 0.3s ease;
                background: rgba(3, 233, 244, 0.05);
            }

            .event-option:hover {
                transform: translateX(10px);
                box-shadow: 0 0 15px rgba(3, 233, 244, 0.5);
                background: rgba(3, 233, 244, 0.1);
            }

            .event-option input[type="radio"]:checked + label {
                color: #03e9f4;
                text-shadow: 0 0 5px #03e9f4;
            }
        `;

        // Insert the new styles
        const styleSheet = document.createElement("style");
        styleSheet.innerText = additionalStyles;
        document.head.appendChild(styleSheet);

        function updateTotalParticipants() {
            // Start with 0 instead of counting a leader by default.
            const leaderCount = 0;
            const memberInputs = memberInputsContainer.querySelectorAll("input[name^='member-']");
            console.log("Current team members count:", memberInputs.length);
        }
        
        function updateOverallTotalParticipants() {
            let overall = 0;
            selectedEvents.forEach(ev => {
                if (ev.type === "team" || ev.type === "group") {
                    overall += ev.members.length;
                } else {
                    overall += 1;
                }
            });
            overallParticipantsSpan.textContent = overall;
        }

        // Call updateTotalParticipants when any team member input changes
        memberInputsContainer.addEventListener("input", updateTotalParticipants);
        
        // Ensure update after adding a new team select (if applicable)
        document.getElementById("group-size").addEventListener("change", function(){
            generateMemberInputs(parseInt(this.value));
        });
        
        // Initial update now shows 0.
        updateTotalParticipants();

        // Remove or comment out the duplicate event listener block
        // Remove this block if present:
        /*
        document.getElementById('submitBtn').addEventListener('click', async function(e) {
            e.preventDefault();
            console.log("Register button clicked");
            // ...code...
        });
        */

        // The inline onclick handler calls submitRegistration(), which is defined below.});

    async function submitRegistration() {
        const button = document.getElementById('submitButton');
        const buttonText = button.querySelector('.button-text');
        const spinner = button.querySelector('#spinner');
        
        try {
            // Show spinner
            buttonText.textContent = 'Registering...';
            spinner.classList.remove('hidden');
            button.disabled = true;
            
            if (selectedEvents.length === 0) {
                alert('Please select at least one event');
                resetButton();
                return;
            }

            const collegeSelect = document.getElementById('collegeSelect');
            const otherCollege = document.getElementById('otherCollege');
            const college = collegeSelect.value === 'other' ? otherCollege.value : collegeSelect.value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;

            if (!college || !email || !phone) {
                alert('Please fill in all required fields');
                resetButton();
                return;
            }

            const registrationData = {
                email: email,
                phone: phone,
                college: college,
                selectedEvents: selectedEvents,
                totalCost: parseInt(document.querySelector('.total-cost').textContent)
            };
            
            const response = await fetch('/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(registrationData)
            });

            const data = await response.json();
            
            if (data.success) {
                window.location.href = `/acknowledgement/${data.ack_id}`;
            } else {
                alert('Registration failed: ' + (data.message || 'Unknown error'));
                resetButton();
            }
        } catch (error) {
            alert('An error occurred. Please try again.');
            resetButton();
        }

        function resetButton() {
            buttonText.textContent = 'Register Now';
            spinner.classList.add('hidden');
            button.disabled = false;
        }
    }

    // Update group size input validation
    groupSizeInput.addEventListener("input", function() {
        if (!currentEventSelection || currentEventSelection.type !== "team") return;
        
        let value = parseInt(this.value);
        const min = currentEventSelection.minTeam;
        const max = currentEventSelection.maxTeam;
        
        // Handle NaN cases (empty input or invalid numbers)
        if (isNaN(value)) {
            value = min;
        }
        
        // Clamp value between min and max
        value = Math.min(Math.max(value, min), max);
        
        // Update input value
        this.value = value;
        
        // Clear any errors
        groupSizeError.textContent = "";
        groupSizeError.classList.add("hidden");
        addEventBtn.disabled = false;
        
        generateMemberInputs(value);
    });

    // Update member inputs generation
    function generateMemberInputs(count) {
        if (!currentEventSelection || currentEventSelection.type !== "team") return;
        
        memberInputsContainer.innerHTML = '';
        teamMembersContainer.classList.remove("hidden");
        
        // Use the actual count without clamping
        for (let i = 1; i <= count; i++) {
            const memberDiv = document.createElement("div");
            memberDiv.className = "member-input grid grid-cols-2 gap-4 mb-4";
            
            // Name Input Wrapper
            const nameWrapper = document.createElement("div");
            const nameLabel = document.createElement("label");
            nameLabel.className = "block text-sm sm:text-base text-[#00FFFF] mb-2";
            nameLabel.innerHTML = `Member ${i} Name <span class="text-red-500">*</span>`;
            
            const nameInput = document.createElement("input");
            nameInput.type = "text";
            nameInput.id = `member-${i}`;
            nameInput.name = `member-${i}`;
            nameInput.placeholder = `Member ${i} Name`;
            nameInput.className = "w-full p-2 sm:p-3 text-sm sm:text-base bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white \
                                 placeholder:text-gray-400 outline-none transition-all duration-300 \
                                 focus:border-[#FF00FF] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]";
            // Add name validation for team member name
            nameInput.addEventListener('input', function() {
                validateMemberName(this);
            });
            nameInput.addEventListener('keyup', function() {
                validateMemberName(this);
            });
            
            nameWrapper.appendChild(nameLabel);
            nameWrapper.appendChild(nameInput);
            
            // USN Input Wrapper
            const usnWrapper = document.createElement("div");
            const usnLabel = document.createElement("label");
            usnLabel.className = "block text-sm sm:text-base text-[#00FFFF] mb-2";
            usnLabel.innerHTML = `Member ${i} USN <span class="text-red-500">*</span>`;
            
            const usnInput = document.createElement("input");
            usnInput.type = "text";
            usnInput.id = `usn-${i}`;
            usnInput.name = `usn-${i}`;
            usnInput.placeholder = "Enter USN (e.g., 1KS22MB023)";
            usnInput.pattern = "[1-4][A-Z]{2}[0-9]{2}[A-Z]{2}[0-9]{3}";
            usnInput.className = "w-full p-2 sm:p-3 text-sm sm:text-base bg-[rgba(32,34,39,0.8)] border-2 border-[#00FFFF] rounded-lg text-white \
                                placeholder:text-gray-400 outline-none transition-all duration-300 \
                                focus:border-[#FF00FF] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]";
            
            usnWrapper.appendChild(usnLabel);
            usnWrapper.appendChild(usnInput);
            
            memberDiv.appendChild(nameWrapper);
            memberDiv.appendChild(usnWrapper);
            memberInputsContainer.appendChild(memberDiv);
        }
    }

    // Add these new button handlers
    const decreaseBtn = document.getElementById("decrease-size");
    const increaseBtn = document.getElementById("increase-size");
    
    function updateGroupSize(delta) {
        if (!currentEventSelection || currentEventSelection.type !== "team") return;
        // Read current value from the groupSizeInput variable
        let currentValue = parseInt(groupSizeInput.value) || currentEventSelection.minTeam;
        let newValue = currentValue + delta;
        // Clamp the new value between minTeam and maxTeam
        newValue = Math.max(currentEventSelection.minTeam, Math.min(newValue, currentEventSelection.maxTeam));
        groupSizeInput.value = newValue;
        // Update button disabled states using the captured references
        decreaseBtn.disabled = newValue <= currentEventSelection.minTeam;
        increaseBtn.disabled = newValue >= currentEventSelection.maxTeam;
        generateMemberInputs(newValue);
    }
    
    decreaseBtn.addEventListener("click", () => updateGroupSize(-1));
    increaseBtn.addEventListener("click", () => updateGroupSize(1));
    
    // Also make sure when a new team event is selected, initialize the buttons:
    eventsContainer.addEventListener("change", function(e) {
        if (e.target.type === "radio") {
            const selectedEvent = events[categorySelect.value].find(event => event.name === e.target.value);
            if (selectedEvent && selectedEvent.type === "team") {
                currentEventSelection = selectedEvent;
                groupSizeInput.value = selectedEvent.minTeam;
                decreaseBtn.disabled = true;
                increaseBtn.disabled = selectedEvent.minTeam >= selectedEvent.maxTeam;
                groupSizeContainer.classList.remove("hidden");
                teamMembersContainer.classList.remove("hidden");
                individualParticipantContainer.classList.add("hidden");
                generateMemberInputs(selectedEvent.minTeam);
            }
            // ...existing radio change handler logic for individual events...
        }
    });

    function handleCollegeSelection() {
        const selectElement = document.getElementById('collegeSelect');
        const otherInput = document.getElementById('otherCollege');
        
        if (selectElement.value === 'other') {
            otherInput.classList.remove('hidden');
            otherInput.required = true;
            otherInput.value = ''; // Clear any previous value
        } else {
            otherInput.classList.add('hidden');
            otherInput.required = false;
            otherInput.value = selectElement.value; // Set the selected college value
        }
    }

    // Add to your form submission logic
    document.querySelector('form').addEventListener('submit', function(e) {
        const selectElement = document.getElementById('collegeSelect');
        const otherInput = document.getElementById('otherCollege');
        
        // Ensure the college value is properly set before submission
        if (selectElement.value === 'other') {
            if (!otherInput.value.trim()) {
                e.preventDefault();
                alert('Please enter your college name');
            }
        }
    });

// Initialize selectedEvents array and event handlers
document.addEventListener('DOMContentLoaded', function() {
    let selectedEvents = [];
    let currentEventSelection = null;

    // Enable category select
    categorySelect.disabled = false;

    // Reset any previously disabled elements
    const radioInputs = document.querySelectorAll('input[name="event"]');
    radioInputs.forEach(input => input.disabled = false);
    
    // Clear any previous selections
    eventsContainer.innerHTML = '<p class="text-gray-400">Please select a category first.</p>';
    
    categorySelect.addEventListener("change", function() {
        const selectedCategory = this.value;
        eventsContainer.innerHTML = '';

        if (selectedCategory && events[selectedCategory]) {
            events[selectedCategory].forEach(event => {
                const div = document.createElement("div");
                div.classList.add("event-option");

                const input = document.createElement("input");
                input.type = "radio";
                input.name = "event";
                input.value = event.name;
                input.id = event.name.replace(/\s+/g, "-").toLowerCase();

                const label = document.createElement("label");
                label.htmlFor = input.id;
                label.textContent = event.name;

                div.appendChild(input);
                div.appendChild(label);
                eventsContainer.appendChild(div);

                // Add change listener to each radio button
                input.addEventListener("change", function() {
                    currentEventSelection = event;
                    addEventBtn.disabled = false;
                    
                    if (event.type === "team") {
                        showTeamInputs(event);
                    } else {
                        showIndividualInput();
                    }
                });
            });
        } else {
            eventsContainer.innerHTML = '<p class="text-gray-400">Please select a category first.</p>';
        }
    });
});

function showTeamInputs(event) {
    groupSizeContainer.classList.remove("hidden");
    teamMembersContainer.classList.remove("hidden");
    individualParticipantContainer.classList.add("hidden");
    
    groupSizeInput.min = event.minTeam;
    groupSizeInput.max = event.maxTeam;
    groupSizeInput.value = event.minTeam;
    
    const sizeLabel = groupSizeContainer.querySelector('label');
    sizeLabel.innerHTML = `<strong>Number of Participants (${event.minTeam}-${event.maxTeam})</strong>`;
    
    generateMemberInputs(event.minTeam);
}

function showIndividualInput() {
    groupSizeContainer.classList.add("hidden");
    teamMembersContainer.classList.add("hidden");
    individualParticipantContainer.classList.remove("hidden");
    individualParticipantInput.required = true;
    individualParticipantInput.value = "";
    document.getElementById('individual-usn').value = "";
}

// ...rest of existing code...

function validateMemberName(input) {
    // Allow only letters and spaces
    let filtered = input.value.replace(/[^A-Za-z\s]/g, '');
    if (input.value !== filtered) {
        input.value = filtered;
        let errorId = `${input.id}-error`;
        let errorElement = document.getElementById(errorId);
        if (!errorElement) {
            errorElement = document.createElement('div');
            errorElement.id = errorId;
            errorElement.className = 'text-red-500 text-sm mt-1';
            input.parentNode.appendChild(errorElement);
        }
        errorElement.textContent = 'Only characters are allowed';
        input.setCustomValidity('Invalid characters');
        addEventBtn.disabled = true;
        return;
    }
    
    if (filtered.trim() === '') {
        input.classList.remove('error-border');
        let errorId = `${input.id}-error`;
        let errorElement = document.getElementById(errorId);
        if (errorElement) { errorElement.textContent = ''; }
        input.setCustomValidity('Name is required');
        addEventBtn.disabled = true;
    } else if (filtered.trim().length < 4) {
        input.classList.add('error-border');
        let errorId = `${input.id}-error`;
        let errorElement = document.getElementById(errorId);
        if (!errorElement) {
            errorElement = document.createElement('div');
            errorElement.id = errorId;
            errorElement.className = 'text-red-500 text-sm mt-1';
            input.parentNode.appendChild(errorElement);
        }
        errorElement.textContent = 'Name must be at least 4 characters';
        input.setCustomValidity('Name too short');
        addEventBtn.disabled = true;
    } else {
        input.classList.remove('error-border');
        let errorId = `${input.id}-error`;
        let errorElement = document.getElementById(errorId);
        if (errorElement) { errorElement.textContent = ''; }
        input.setCustomValidity('');
        const allInputsValid = checkAllMemberInputsValid();
        addEventBtn.disabled = !allInputsValid;
    }
}

function validatePhone() {
    const phoneInput = document.getElementById('phone');
    const phoneError = document.getElementById('phone-error');
    const submitButton = document.getElementById('submitButton');
    
    // Remove non-digits and truncate to 10 characters
    let value = phoneInput.value.replace(/\D/g, '');
    value = value.slice(0, 10); // Prevent input beyond 10 digits
    phoneInput.value = value; // Update the input value

    // Validate with a single regex: 10 digits starting with 6,7,8,9
    const isValid = /^[6-9]\d{9}$/.test(value);

    if (!isValid) {
        phoneInput.classList.add('error-border');
        phoneError.textContent = 'Enter a valid 10-digit number starting with 6, 7, 8, or 9';
        phoneError.classList.remove('hidden');
        submitButton.disabled = true;
        return false;
    } else {
        phoneInput.classList.remove('error-border');
        phoneError.classList.add('hidden');
        submitButton.disabled = false;
        return true;
    }
}

function checkAllMemberInputsValid() {
    const memberInputs = memberInputsContainer.querySelectorAll('input[id^="member-"]');
    const regex = /^[A-Za-z\s.]*$/;
    
    for (const input of memberInputs) {
        const value = input.value.trim();
        if (!regex.test(value) || value.length < 2) {
            return false;
        }
    }
    return true;
}

// Attach the validateMemberName function to all relevant text inputs
document.querySelectorAll('input[type="text"]').forEach(input => {
    if (input.id.startsWith("member-") || input.id === "individual-participant") {
        input.addEventListener('input', function() {
            validateMemberName(this);
        });
    }
});

function checkAllMemberInputsValid() {
    const memberInputs = memberInputsContainer.querySelectorAll('input[id^="member-"]');
    const regex = /^[A-Za-z\s.]*$/;
    
    for (const input of memberInputs) {
        const value = input.value.trim();
        if (!regex.test(value) || value.length < 2) {
            return false;
        }
    }
    return true;
}

function validatePhone() {
    const phoneInput = document.getElementById('phone');
    const phoneError = document.getElementById('phone-error');
    const submitButton = document.getElementById('submitButton');
    
    // Remove non-digits
    const value = phoneInput.value.replace(/\D/g, '');
    phoneInput.value = value;

    if (value.length !== 10) {
        phoneInput.classList.add('error-border');
        phoneError.textContent = 'Enter valid number';
        phoneError.classList.remove('hidden');
        submitButton.disabled = true;
        return false;
    } else {
        phoneInput.classList.remove('error-border');
        phoneError.classList.add('hidden');
        submitButton.disabled = false;
        return true;
    }
}

// Add event listener to prevent non-numeric input
document.getElementById('phone').addEventListener('keypress', function(e) {
    if (e.key < '0' || e.key > '9') {
        e.preventDefault();
    }
});

// Update submitRegistration function to include phone validation
const originalSubmitRegistration = submitRegistration;
submitRegistration = async function() {
    if (!validatePhone()) {
        alert('Please enter a valid 10-digit phone number');
        return;
    }
    await originalSubmitRegistration();
};

function validateEmail() {
    const emailInput = document.getElementById('email');
    const emailError = document.getElementById('email-error');
    const submitButton = document.getElementById('submitButton');

    // Regular expression for email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const isValid = emailRegex.test(emailInput.value.trim());

    if (!isValid) {
        emailInput.classList.add('error-border');
        emailError.textContent = 'Please enter a valid mail id';
        emailError.classList.remove('hidden');
        submitButton.disabled = true;
        return false;
    } else {
        emailInput.classList.remove('error-border');
        emailError.classList.add('hidden');
        submitButton.disabled = false;
        return true;
    }
}
</script>
{% endblock %}