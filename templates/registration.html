{% extends "base.html" %}

{% block title %}Registration - College Fest{% endblock %}

{% block content %}
<div class="h-0.5 bg-[#CD7F32] "></div>
<div class="min-h-screen flex flex-col">
    <!-- Registration Container -->
    <div class="flex-1 container mx-auto px-4 mt-24 mb-8 max-w-3xl">
        <h1 class="text-4xl font-bold text-[#FFD700] text-center mb-10">YUKTI-2025 Registration</h1>

        <!-- Main Form Container -->
        <div class="bg-[rgba(40,40,40,0.95)] p-6 md:p-8 rounded-xl shadow-2xl mb-8">
            <form id="registrationForm" class="space-y-6" onsubmit="event.preventDefault(); submitRegistration();">
                <!-- Event Selection Section -->
                <div class="space-y-6">
                    <div class="form-group">
                        <label for="category" class="block text-xl font-bold text-[#FFD700] mb-2">Select Event Category</label>
                        <select id="category" required 
                                class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#ff6600] rounded-lg text-white
                                      outline-none transition-all duration-300 hover:border-[#03e9f4]">
                            <option value="" disabled selected>--Select--</option>
                            <option value="tech">Manthana (Tech Events)</option>
                            <option value="Cultural">Manoranjana (Cultural Events)</option>
                            <option value="management">Chintana (Management Events)</option>
                            <option value="VisualArt">Kalachitrana (VisualArt)</option>
                            <option value="games">Krida Ratna(Game Events)</option>
                        </select>
                    </div>

                    <!-- Events Container -->
                    <div class="form-group">
                        <label class="block text-xl font-bold text-[#FFD700] mb-2">Select an Event</label>
                        <div id="events-container" 
                             class="grid grid-cols-1 sm:grid-cols-2 gap-4 p-4 bg-[rgba(32,34,39,0.6)] rounded-lg">
                            <p class="text-gray-400">Please select a category first.</p>
                        </div>
                    </div>

                    <!-- Group Size Container -->
                    <div id="group-size-container" class="hidden space-y-2">
                        <label for="group-size" class="block text-xl font-bold text-[#FFD700] mb-2">Number of Participants</label>
                        <input type="number" id="group-size" min="1" max="4" value="1"
                               class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#ff6600] rounded-lg text-white
                                      outline-none transition-all duration-300">
                    </div>

                    <div id="team-members-container" class="hidden space-y-4">
                        <label class="block text-xl font-bold text-[#FFD700] mb-2">Team Members</label>
                        <div id="member-inputs" class="space-y-3">
                            <!-- Member inputs will be generated dynamically -->
                        </div>
                        <div id="team-error" class="text-red-500 text-sm hidden">Please enter all team member names</div>
                    </div>

                    <div id="individual-participant-container" class="hidden space-y-4">
                        <label for="individual-participant" class="block text-xl font-bold text-[#FFD700] mb-2">Participant Name</label>
                        <input type="text" 
                               id="individual-participant" 
                               placeholder="Enter Your Name" 
                               class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#ff6600] rounded-lg text-white
                                      placeholder:text-gray-400 outline-none transition-all duration-300
                                      focus:border-[#03e9f4] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]">
                        <div id="individual-error" class="text-red-500 text-sm hidden">Please enter participant name</div>
                    </div>

                    <!-- Add Button -->
                    <button type="button" id="add-event-btn" disabled
                            class="w-full bg-[#ff6600] text-white py-3 px-6 rounded-lg font-bold uppercase 
                                   transition-all duration-300 hover:bg-[#e65c00] hover:-translate-y-1 
                                   hover:shadow-[0_8px_15px_rgba(255,103,0,0.4)] disabled:opacity-50 
                                   disabled:cursor-not-allowed">
                        + Add Event
                    </button>
                </div>
            </form>
        </div>

        <!-- Add this after the add-event-btn  -->
        <div class="selected-events-section hidden mt-8 bg-[rgba(40,40,40,0.95)] p-6 rounded-xl border-2 border-[#ff6600]">
            <h3 class="text-2xl font-bold text-[#FFD700] mb-6">Selected Events</h3>
            <div id="selected-events-list" class="space-y-4">
                <!-- Selected events will be dynamically added here -->
            </div>
            
            <!-- Personal Details Section -->
            <div class="personal-details-section mt-8 space-y-6">
                <h3 class="text-2xl font-bold text-[#FFD700] mb-6">Personal Details</h3>
                <div class="space-y-4">
                    <div>
                        <label for="college" class="block text-white mb-2">College Name</label>
                        <input type="text" 
                               id="college" 
                               placeholder="Enter your college name" 
                               required
                               class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#ff6600] rounded-lg text-white
                                      placeholder:text-gray-400 outline-none transition-all duration-300
                                      focus:border-[#03e9f4] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]">
                    </div>
                    
                    <div>
                        <label for="email" class="block text-white mb-2">Email</label>
                        <input type="email" 
                               id="email" 
                               placeholder="Enter your email" 
                               required
                               class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#ff6600] rounded-lg text-white
                                      placeholder:text-gray-400 outline-none transition-all duration-300
                                      focus:border-[#03e9f4] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]">
                    </div>
                    
                    <div>
                        <label for="phone" class="block text-white mb-2">Phone (WhatsApp)</label>
                        <input type="tel" 
                               id="phone" 
                               placeholder="Enter your WhatsApp number" 
                               required
                               class="w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#ff6600] rounded-lg text-white
                                      placeholder:text-gray-400 outline-none transition-all duration-300
                                      focus:border-[#03e9f4] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]">
                    </div>
                </div>

                <div class="mt-4">
                    <p class="text-gray-400 mb-2">*Accommodation is not available.</p>
                    <p class="text-xl font-bold text-[#FFD700]">Total Cost: ₹<span class="total-cost">0</span></p>
                </div>

                <button type="button" 
                        onclick="submitRegistration()"
                        class="w-full bg-[#ff6600] text-white py-3 px-6 rounded-lg font-bold uppercase 
                               transition-all duration-300 hover:bg-[#e65c00] hover:-translate-y-1 
                               hover:shadow-[0_8px_15px_rgba(255,103,0,0.4)]">
                    Register Now
                </button>
            </div>
        </div>
    </div>
</div>
<div class="h-0.5 bg-[#CD7F32] "></div>

<!-- Replace the existing <style> section with these classes -->
<style>
.selected-event {
    background: rgba(46,46,46,0.9);
    padding: 1rem;
    border-radius: 0.5rem;
    border: 2px solid #ff6600;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.selected-event span {
    color: #C0C0C0;
    word-break: break-word;
    max-width: 80%;
}

.remove-event-btn {
    color: rgb(239, 68, 68);
    font-weight: bold;
    font-size: 1.25rem;
    padding: 0.5rem;
    transition: color 0.3s;
}

.remove-event-btn:hover {
    color: rgb(248, 113, 113);
}

.event-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    border-radius: 0.5rem;
    cursor: pointer;
}

.event-option input[type="radio"] {
    width: 1rem;
    height: 1rem;
    cursor: pointer;
    accent-color: #03e9f4;
}

.event-option label {
    color: #C0C0C0;
    cursor: pointer;
    user-select: none;
}

.error-border {
    border-color: rgb(239, 68, 68);
}

/* Additional Styles */
.event-option {
    border: 2px solid #03e9f4;
    transition: all 0.3s ease;
    background: rgba(3, 233, 244, 0.05);
}

.event-option:hover {
    transform: translateX(10px);
    box-shadow: 0 0 15px rgba(3, 233, 244, 0.5);
    background: rgba(3, 233, 244, 0.1);
}

.event-option input[type="radio"]:checked + label {
    color: #03e9f4;
    text-shadow: 0 0 5px #03e9f4;
}

.member-input {
    margin-bottom: 0.75rem;
}

.member-input input {
    width: 100%;
    padding: 0.75rem;
    background: rgba(32,34,39,0.8);
    border: 2px solid #ff6600;
    border-radius: 0.5rem;
    color: white;
    outline: none;
    transition: all 0.3s ease;
}

.member-input input:focus {
    border-color: #03e9f4;
    box-shadow: 0 0 8px rgba(3,233,244,0.4);
}

.member-input input::placeholder {
    color: #9CA3AF;
}

/* Responsive styles for all devices */
@media (max-width: 640px) {
    .flex-1.container {
        padding: 0.5rem;
        margin-top: 5rem;
    }

    h1.text-4xl {
        font-size: 1.75rem;
        margin-bottom: 1.5rem;
    }

    .form-group label {
        font-size: 1rem;
    }

    #events-container {
        padding: 0.75rem;
    }

    .selected-event {
        padding: 0.75rem;
        font-size: 0.875rem;
    }

    .selected-event span {
        font-size: 0.875rem;
    }

    .member-input input {
        padding: 0.5rem;
        font-size: 0.875rem;
    }

    .personal-details-section h3 {
        font-size: 1.25rem;
        margin-bottom: 1rem;
    }

    .personal-details-section label {
        font-size: 0.875rem;
    }

    .personal-details-section input {
        padding: 0.5rem;
        font-size: 0.875rem;
    }

    .total-cost {
        font-size: 1.25rem;
    }

    button {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
    }

    #paymentSection {
        padding: 1rem;
    }

    #paymentSection h2 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }

    .bank-details h3 {
        font-size: 1.25rem;
    }

    .account-details {
        font-size: 0.875rem;
    }
}

/* Tablet adjustments */
@media (min-width: 641px) and (max-width: 1024px) {
    .flex-1.container {
        padding: 1rem;
    }

    h1.text-4xl {
        font-size: 2rem;
    }

    .form-group label {
        font-size: 1.125rem;
    }
}

/* Ensure touch targets are large enough on mobile */
@media (hover: none) and (pointer: coarse) {
    input, 
    select, 
    button {
        min-height: 44px;
    }

    .event-option {
        padding: 0.75rem;
    }

    .remove-event-btn {
        padding: 0.5rem 0.75rem;
        font-size: 1.25rem;
    }
}

/* Professional spacing adjustments */
.space-y-6 > * {
    margin-top: 1rem;
    margin-bottom: 1rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.shadow-xl {
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

/* Improved input styling */
input, select {
    font-size: 0.9375rem;
    letter-spacing: 0.01em;
}

/* Better text readability */
label, p {
    letter-spacing: 0.01em;
    line-height: 1.5;
}

/* Add container width adjustments for different screen sizes */
@media (max-width: 640px) {
    .container {
        max-width: 95%;
        padding: 0 1rem;
    }
}

@media (min-width: 641px) and (max-width: 1024px) {
    .container {
        max-width: 85%;
        padding: 0 2rem;
    }
}

@media (min-width: 1025px) {
    .container {
        max-width: 800px; /* Fixed maximum width for larger screens */
    }
}
</style>

<!-- Keep existing JavaScript -->
<script>
    // Declare selectedEvents globally so that submitRegistration can access it.
    let selectedEvents = [];

    document.addEventListener("DOMContentLoaded", function () {
        const categorySelect = document.getElementById("category");
        const eventsContainer = document.getElementById("events-container");
        const groupSizeContainer = document.getElementById("group-size-container");
        const groupSizeInput = document.getElementById("group-size");
        const teamMembersContainer = document.getElementById("team-members-container");
        const memberInputsContainer = document.getElementById("member-inputs");
        const addEventBtn = document.getElementById("add-event-btn");
        const selectedEventsList = document.getElementById("selected-events-list");
        const selectedEventsSection = document.querySelector(".selected-events-section");
        const personalDetailsSection = document.querySelector(".personal-details-section");
        const groupSizeError = document.getElementById("group-size-error");
        const individualParticipantContainer = document.getElementById("individual-participant-container");
        const individualParticipantInput = document.getElementById("individual-participant");
        const overallParticipantsSpan = document.getElementById("overallParticipants");

        let currentEventSelection = null;

        
        const events = {
            tech: [
                { name: "Prakalpa Prastuthi (Live Project Expo)", type: "team", cost: 200, minTeam: 1, maxTeam: 3 },
                { name: "CHANAKSH (CODING EVENT)", type: "individual", cost: 100 },
                { name: "Robo Samara(Robo War)", type: "team", cost: 300, minTeam: 1, maxTeam: 4},
                { name: "Robo Samara(Robo Race)", type: "team", cost: 300, minTeam: 1, maxTeam: 4},
                { name: "Pragyan(Quiz)", type: "team", cost: 300, minTeam: 1, maxTeam: 4},
                { name: "Vagmita (Elocution)", type: "individual", cost: 200 }
            ],
            VisualArt: [
                
                { name: "Sthala Chitrapatha (Spot Photography)", type: "individual", cost: 150 },
                { name: "Chitragatha (Short Film)", type: "team", cost: 400, minTeam: 1, maxTeam: 4 },
                { name: "RUPEKHA (Sketch Art)", type: "individual", cost: 200 },
                { name: "Hastakala (Painting)", type: "individual", cost: 150 },
                { name: "Swachitra (Selfie Point)", type: "individual", cost: 100 },
            ],
            Cultural: [
                { name: "NINAAD (Singing Solo )", type: "individual", cost: 200 },
                { name: "NINAAD (Singing Group)", type: "team", cost: 200,minTeam:1, maxTeam:10 },
                { name: "Nritya Saadhana (Dance Solo )", type: "individual", cost: 200 },
                { name: "Nritya Saadhana (Dance Group)", type: "team", cost: 200 ,minTeam:4, maxTeam:8},
               
                { name: "Navyataa (Ramp Walk)", type: "individual", cost: 300 },
            ],
            management: [
               
                { name: "DAKSH (THE BEST MANAGER)", type: "individual", cost: 300 },
                { name: "SHRESHTA VITTA (FINANCE) Final", type: "individual", cost: 200 },
                { name: "MANAVA SANSADHAN (HR)", type: "team", cost: 300, minTeam: 1, maxTeam: 4 },
                { name: "Sumedha(Start Up)", type: "individual", cost: 150 },
                { name: "Vipanan(Marketing)", type: "team", cost: 150,minTeam:2 ,maxTeam:2 }
            ],
            games: [
                { name: "BGMI", type: "team", cost: 400, minTeam: 1, maxTeam: 5 },
                { name: "Talaash", type: "team", cost: 300, minTeam: 1, maxTeam: 5 }
            ]
        };

        function updateTotalCost() {
            let totalCost = 0;
            selectedEvents.forEach(event => {
                totalCost += event.cost; // Use the actual event cost instead of COST_PER_EVENT
            });
            document.querySelector('.total-cost').textContent = totalCost;
        }

        // Remove or comment out the COST_PER_EVENT constant since we're not using it anymore
        // const COST_PER_EVENT = 200;

        groupSizeInput.addEventListener("change", function() {
            const numberOfMembers = parseInt(this.value);
            generateMemberInputs(numberOfMembers);
        });

        // Modified team member input generator to clamp count between minTeam and maxTeam
        function generateMemberInputs(count) {
            memberInputsContainer.innerHTML = '';
            teamMembersContainer.classList.remove("hidden");

            if (currentEventSelection && currentEventSelection.type === "team") {
                // Clamp count between event.minTeam and event.maxTeam
                count = Math.min(Math.max(parseInt(count), currentEventSelection.minTeam), currentEventSelection.maxTeam);
                groupSizeInput.value = count;

                for (let i = 1; i <= count; i++) {
                    const memberDiv = document.createElement("div");
                    memberDiv.className = "member-input";
                    
                    const memberInput = document.createElement("input");
                    memberInput.type = "text";
                    memberInput.id = `member-${i}`;
                    memberInput.name = `member-${i}`;
                    memberInput.placeholder = `Member ${i} Name`;
                    memberInput.className = "w-full p-3 bg-[rgba(32,34,39,0.8)] border-2 border-[#ff6600] rounded-lg text-white \
                                           placeholder:text-gray-400 outline-none transition-all duration-300 \
                                           focus:border-[#03e9f4] focus:shadow-[0_0_8px_rgba(3,233,244,0.4)]";
                    
                    memberDiv.appendChild(memberInput);
                    memberInputsContainer.appendChild(memberDiv);
                }
            }
            updateTotalParticipants();
        }

        addEventBtn.addEventListener("click", function() {
            if (currentEventSelection) {
                let hasError = false;

                // Validate individual participant
                if (currentEventSelection.type === "individual") {
                    const participantName = individualParticipantInput.value.trim();
                    const errorDiv = document.getElementById('individual-error');
                    
                    if (!participantName) {
                        errorDiv.style.display = 'block';
                        individualParticipantInput.classList.add('error-border');
                        hasError = true;
                    } else {
                        errorDiv.style.display = 'none';
                        individualParticipantInput.classList.remove('error-border');
                    }
                }
                
                // Validate team members
                if (currentEventSelection.type === "team") {
                    const memberInputs = document.querySelectorAll("#member-inputs input");
                    const errorDiv = document.getElementById('team-error');
                    let emptyMembers = false;
                    
                    memberInputs.forEach(input => {
                        if (!input.value.trim()) {
                            input.classList.add('error-border');
                            emptyMembers = true;
                        } else {
                            input.classList.remove('error-border');
                        }
                    });
                    
                    if (emptyMembers) {
                        errorDiv.style.display = 'block';
                        hasError = true;
                    } else {
                        errorDiv.style.display = 'none';
                    }
                }

                // Only proceed if there are no errors
                if (!hasError) {
                    const eventDetails = {
                        category: categorySelect.value,
                        event: currentEventSelection.name,  // This is the event name from the events object
                        type: currentEventSelection.type,
                        cost: currentEventSelection.cost,
                        minTeam: currentEventSelection.minTeam,
                        maxTeam: currentEventSelection.maxTeam
                    };

                    if (currentEventSelection.type === "team") {
                        eventDetails.members = [];
                        const memberInputs = document.querySelectorAll("#member-inputs input");
                        memberInputs.forEach(input => {
                            if (input.value.trim()) {
                                eventDetails.members.push(input.value.trim());
                            }
                        });
                    } else {
                        // For individual events, record the participant's name
                        eventDetails.participant = individualParticipantInput.value.trim();
                    }

                    console.log("Adding event:", eventDetails); // Debug log
                    selectedEvents.push(eventDetails);
                    updateSelectedEventsList();
                    updateTotalCost();
                    resetEventSelection();
                    selectedEventsSection.classList.remove("hidden");
                    personalDetailsSection.classList.remove("hidden");
                }
            }
        });

        function updateSelectedEventsList() {
            const selectedEventsList = document.getElementById('selected-events-list');
            const selectedEventsSection = document.querySelector('.selected-events-section');
            selectedEventsList.innerHTML = '';
            
            selectedEvents.forEach((event, index) => {
                const eventDiv = document.createElement('div');
                eventDiv.className = 'selected-event';
                
                let membersText = '';
                if (event.members && event.members.length > 0) {
                    membersText = `<br>Members: ${event.members.join(", ")}`;
                } else if (event.participant) {
                    membersText = `<br>Participant: ${event.participant}`;
                }

                eventDiv.innerHTML = `
                    <span>${event.event} - ${event.type.charAt(0).toUpperCase() + event.type.slice(1)}
                    <br>Category: ${event.category}${membersText}
                    <br>Cost: ₹${event.cost}</span>
                    <button type="button" onclick="removeEvent(${index})" class="remove-event-btn">×</button>
                `;
                
                selectedEventsList.appendChild(eventDiv);
            });

            // Show/hide sections based on selected events
            if (selectedEvents.length > 0) {
                selectedEventsSection.classList.remove('hidden');
                document.querySelector('.personal-details-section').classList.remove('hidden');
            } else {
                selectedEventsSection.classList.add('hidden');
                document.querySelector('.personal-details-section').classList.add('hidden');
            }
            
            updateTotalCost();
        }

        function resetEventSelection() {
            const radioInputs = document.querySelectorAll('input[name="event"]');
            radioInputs.forEach(input => input.checked = false);
            groupSizeContainer.classList.add("hidden");
            teamMembersContainer.classList.add("hidden");
            individualParticipantContainer.classList.add("hidden");
            currentEventSelection = null;
            addEventBtn.disabled = true;
        }

        window.removeEvent = function(index) {
            selectedEvents.splice(index, 1);
            updateSelectedEventsList();
            updateTotalCost(); // Add this line
            if (selectedEvents.length === 0) {
                selectedEventsSection.classList.add("hidden");
                personalDetailsSection.classList.add("hidden");
            }
        };

        categorySelect.addEventListener("change", function () {
            const selectedCategory = categorySelect.value;
            eventsContainer.innerHTML = '';

            if (selectedCategory && events[selectedCategory]) {
                events[selectedCategory].forEach(event => {
                    let div = document.createElement("div");
                    div.classList.add("event-option");

                    let input = document.createElement("input");
                    input.type = "radio";
                    input.name = "event";
                    input.value = event.name;
                    input.id = event.name.replace(/\s+/g, "-").toLowerCase();

                    let label = document.createElement("label");
                    label.htmlFor = input.id;
                    label.textContent = `${event.name} ${event.type === 'team' ? `(${event.minTeam}-${event.maxTeam} members)` : ''}`;

                    input.addEventListener("change", function () {
                        currentEventSelection = event;
                        addEventBtn.disabled = false;
                        
                        if (event.type === "team") {
                            groupSizeContainer.classList.remove("hidden");
                            teamMembersContainer.classList.remove("hidden");
                            individualParticipantContainer.classList.add("hidden");
                            
                            // Set min and max based on event configuration
                            groupSizeInput.min = event.minTeam;
                            groupSizeInput.max = event.maxTeam;
                            groupSizeInput.value = event.minTeam;
                            
                            // Update label to show allowed team size
                            const sizeLabel = groupSizeContainer.querySelector('label');
                            sizeLabel.innerHTML = `<strong>Number of Participants (${event.minTeam}-${event.maxTeam})</strong>`;
                        } else {
                            groupSizeContainer.classList.add("hidden");
                            teamMembersContainer.classList.add("hidden");
                            individualParticipantContainer.classList.remove("hidden");
                            individualParticipantInput.required = true;
                            individualParticipantInput.value = ""; // clear previous value
                            groupSizeInput.value = 1;
                        }
                        
                        generateMemberInputs(parseInt(groupSizeInput.value));
                    });

                    div.appendChild(input);
                    div.appendChild(label);
                    eventsContainer.appendChild(div);
                });
            } else {
                eventsContainer.innerHTML = '<p>Please select a category first.</p>';
            }
        });

        // Validate team size when changed
        groupSizeInput.addEventListener("change", function() {
            const value = parseInt(this.value);
            const min = parseInt(this.min);
            const max = parseInt(this.max);

            if (value < min) {
                this.value = min;
            } else if (value > max) {
                this.value = max;
            }

            generateMemberInputs(parseInt(this.value));
        });

        // Modified event radio button change handler
        eventsContainer.addEventListener("change", function(e) {
            if (e.target.type === "radio") {
                const selectedEvent = events[categorySelect.value].find(event => event.name === e.target.value);
                if (selectedEvent) {
                    currentEventSelection = selectedEvent;
                    addEventBtn.disabled = false;

                    if (selectedEvent.type === "team") {
                        groupSizeContainer.classList.remove("hidden");
                        teamMembersContainer.classList.remove("hidden");
                        individualParticipantContainer.classList.add("hidden");
                        
                        // Update input attributes and value
                        groupSizeInput.min = selectedEvent.minTeam;
                        groupSizeInput.max = selectedEvent.maxTeam;
                        groupSizeInput.value = selectedEvent.minTeam;
                        
                        // Update label
                        const sizeLabel = groupSizeContainer.querySelector('label');
                        sizeLabel.innerHTML = `<strong>Number of Participants (${selectedEvent.minTeam}-${selectedEvent.maxTeam})</strong>`;
                        
                        generateMemberInputs(selectedEvent.minTeam);
                    } else {
                        // For individual events, hide team inputs and show participant field
                        groupSizeContainer.classList.add("hidden");
                        teamMembersContainer.classList.add("hidden");
                        individualParticipantContainer.classList.remove("hidden");
                        individualParticipantInput.required = true;
                        individualParticipantInput.value = ""; // clear previous value
                        groupSizeInput.value = 1;
                    }
                }
            }
        });

        // Group size input validation
        groupSizeInput.addEventListener("input", function() {
            if (!currentEventSelection) return;
            
            let value = parseInt(this.value) || 0;
            const min = currentEventSelection.minTeam || 1;
            const max = currentEventSelection.maxTeam || 1;
            
            if (value < min) value = min;
            if (value > max) value = max;
            
            this.value = value;
            generateMemberInputs(value);
        });

        // Restrict groupSizeInput value on user input
        groupSizeInput.addEventListener("input", function() {
            if (!currentEventSelection || currentEventSelection.type !== "team") return;
            
            let value = parseInt(this.value) || currentEventSelection.minTeam;
            const min = currentEventSelection.minTeam;
            const max = currentEventSelection.maxTeam;
            
            if (value < min || value > max) {
                groupSizeError.textContent = `Please enter a value between ${min} and ${max}.`;
                groupSizeError.classList.remove("hidden");
                addEventBtn.disabled = true;
            } else {
                groupSizeError.textContent = "";
                groupSizeError.classList.add("hidden");
                addEventBtn.disabled = false;
                this.value = value;
                generateMemberInputs(value);
            }
        });

        // Add new styles for event options
        const additionalStyles = `
            .event-option {
                border: 2px solid #03e9f4;
                transition: all 0.3s ease;
                background: rgba(3, 233, 244, 0.05);
            }

            .event-option:hover {
                transform: translateX(10px);
                box-shadow: 0 0 15px rgba(3, 233, 244, 0.5);
                background: rgba(3, 233, 244, 0.1);
            }

            .event-option input[type="radio"]:checked + label {
                color: #03e9f4;
                text-shadow: 0 0 5px #03e9f4;
            }
        `;

        // Insert the new styles
        const styleSheet = document.createElement("style");
        styleSheet.innerText = additionalStyles;
        document.head.appendChild(styleSheet);

        function updateTotalParticipants() {
            // Start with 0 instead of counting a leader by default.
            const leaderCount = 0;
            const memberInputs = memberInputsContainer.querySelectorAll("input[name^='member-']");
            console.log("Current team members count:", memberInputs.length);
        }
        
        function updateOverallTotalParticipants() {
            let overall = 0;
            selectedEvents.forEach(ev => {
                if (ev.type === "team" || ev.type === "group") {
                    overall += ev.members.length;
                } else {
                    overall += 1;
                }
            });
            overallParticipantsSpan.textContent = overall;
        }

        // Call updateTotalParticipants when any team member input changes
        memberInputsContainer.addEventListener("input", updateTotalParticipants);
        
        // Ensure update after adding a new team select (if applicable)
        document.getElementById("group-size").addEventListener("change", function(){
            generateMemberInputs(parseInt(this.value));
        });
        
        // Initial update now shows 0.
        updateTotalParticipants();

        // Remove or comment out the duplicate event listener block
        // Remove this block if present:
        /*
        document.getElementById('submitBtn').addEventListener('click', async function(e) {
            e.preventDefault();
            console.log("Register button clicked");
            // ...code...
        });
        */

        // The inline onclick handler calls submitRegistration(), which is defined below.
    });

    async function submitRegistration() {
        try {
            if (selectedEvents.length === 0) {
                alert('Please select at least one event');
                return;
            }

            const college = document.getElementById('college').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;

            if (!college || !email || !phone) {
                alert('Please fill in all required fields');
                return;
            }

            // Format the selected events with correct field names
            const formattedEvents = selectedEvents.map(event => ({
                event: event.event,           // Use 'event' instead of 'name'
                type: event.type,             
                cost: event.cost,             
                category: event.category,      
                members: event.members || [],  
                participant: event.participant 
            }));

            const registrationData = {
                email: email,
                phone: phone,
                college: college,
                selectedEvents: formattedEvents,
                totalCost: parseInt(document.querySelector('.total-cost').textContent)
            };
            
            console.log('Sending registration data:', registrationData);

            const response = await fetch('/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(registrationData)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            console.log('Server response:', data);
            
            if (data.success) {
                window.location.href = `/acknowledgement/${data.ack_id}`;
            } else {
                alert('Registration failed: ' + (data.message || 'Unknown error'));
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        }
    }
</script>
{% endblock %}
